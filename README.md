# Tochka Rosta Core

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ - SaaS —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞, –≥–¥–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ –∞—Ä–µ–Ω–¥—É—é—Ç –≥–æ—Ç–æ–≤—ã–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –±–∏–∑–Ω–µ—Å—ã (–ú–æ–¥—É–ª–∏) –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–Ω–∏–º–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Vertical Slices** —Å –ø–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ø–¥—Ä–æ–º –∏ –ú–æ–¥—É–ª—è–º–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tochkarosta_core/
‚îú‚îÄ‚îÄ core-backend/           # –Ø–î–†–û (Port 8000)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/           # Config, DB Session
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/         # User, Tenant
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules/        # –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/       # JWT, Login, Register
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tenants/    # Tenant Management
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ billing/    # Tariffs & Subscriptions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/          # JWT, Hashing
‚îÇ   ‚îî‚îÄ‚îÄ alembic/             # Database Migrations
‚îÇ
‚îú‚îÄ‚îÄ core-frontend/          # –ò–ù–¢–ï–†–§–ï–ô–°–´ (Port 7000)
‚îÇ   ‚îî‚îÄ‚îÄ app/                # Next.js 14 App Router
‚îÇ
‚îú‚îÄ‚îÄ gateway/                 # –ü–†–û–ö–°–ò (Port 3000)
‚îÇ   ‚îî‚îÄ‚îÄ src/                # Dynamic Subdomain Routing
‚îÇ
‚îî‚îÄ‚îÄ modules/                # –ü–ê–ü–ö–ê –° –ú–û–î–£–õ–Ø–ú–ò
    ‚îî‚îÄ‚îÄ shop/               # –ú–æ–¥—É–ª—å –ú–∞–≥–∞–∑–∏–Ω–∞ (–ø—Ä–∏–º–µ—Ä)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Node.js 18+
- PostgreSQL 14+
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è OTP –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)

### Backend Setup

```bash
cd core-backend

# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Windows)
venv\Scripts\activate

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Linux/Mac)
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª (—É–∂–µ —Å–æ–∑–¥–∞–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "init"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
python -m uvicorn app.main:app --reload
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`

### Frontend Setup

```bash
cd core-frontend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev
```

Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:7000`

### Gateway Setup

```bash
cd gateway

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev
```

Gateway –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:3000`

## üìö API Endpoints

### Authentication (`/api/auth`)
- `POST /api/auth/check-phone` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/send-code` - –û—Ç–ø—Ä–∞–≤–∫–∞ OTP –∫–æ–¥–∞ (–≤ DEV —Ä–µ–∂–∏–º–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å)
- `POST /api/auth/login-password` - –í—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é
- `POST /api/auth/register-full` - –ü–æ–ª–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

### Tenants (`/api/tenants`)
- `GET /api/tenants/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π tenant (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `GET /api/tenants/{tenant_id}` - –ü–æ–ª—É—á–∏—Ç—å tenant –ø–æ ID

### Billing (`/api/billing`)
- `GET /api/billing/tariffs` - –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
- `GET /api/billing/tariffs/{tariff_id}` - –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ
- `GET /api/billing/subscriptions/{tenant_id}` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
- `POST /api/billing/subscriptions` - –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

## üîê –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏–∑–æ–ª—è—Ü–∏–∏ (THE IRON WALL)

### –Ø–î–†–û (CORE) –ù–ò–ö–û–ì–î–ê –ù–ï –ó–ù–ê–ï–¢:
- –û —Ç–æ–≤–∞—Ä–∞—Ö, –∫–æ—Ä–∑–∏–Ω–∞—Ö, –∑–∞–∫–∞–∑–∞—Ö –ö–ª–∏–µ–Ω—Ç–æ–≤
- –û –¥–µ–Ω—å–≥–∞—Ö –ö–ª–∏–µ–Ω—Ç–æ–≤ (–æ–ø–ª–∞—Ç–∞ –∏–¥–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –í–ª–∞–¥–µ–ª—å—Ü—É)
- –û —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î –ú–æ–¥—É–ª–µ–π

### –ú–û–î–£–õ–¨ (MODULE) –ù–ò–ö–û–ì–î–ê –ù–ï –ó–ù–ê–ï–¢:
- –û –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ø–¥—Ä–∞
- –û –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
- –û –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–∞—Ö (–ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ SDK)

## üéØ –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã

| –†–æ–ª—å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| –û—Å–Ω–æ–≤–∞—Ç–µ–ª—å (Founder) | 7003 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π |
| –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Master) | 7001 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º |
| –í–ª–∞–¥–µ–ª–µ—Ü (Owner) | 7001 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º –±–∏–∑–Ω–µ—Å–æ–º |
| –ö–ª–∏–µ–Ω—Ç (Buyer) | 7000 | –ü–æ–∫—É–ø–∞—Ç–µ–ª—å —Ç–æ–≤–∞—Ä–æ–≤ |

## üìù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
cd core-backend
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
alembic upgrade head
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Backend health check
curl http://localhost:8000/health

# Gateway health check
curl http://localhost:3000/health
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã

## üë• –ö–æ–º–∞–Ω–¥–∞

CTO –∏ –í–µ–¥—É—â–∏–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä: –ó–∞—â–∏—Ç–∞ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –Ø–¥—Ä–∞, –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.







