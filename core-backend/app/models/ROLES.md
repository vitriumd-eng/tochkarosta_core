# Роли пользователей в системе

## Иерархия ролей

Иерархия ролей от высшей к низшей (по уровню доступа):

```
1. super_admin (Основатель) - владелец платформы
   └── 2. platform_master (Модератор) - модератор контента платформы
   
3. user (Пользователь) - публичный пользователь (просматривает платформеную страницу)

4. subscriber (Подписчик) - арендует платформу для бизнеса
   └── 5. buyer (Покупатель) - клиент подписчика, покупает товары/услуги
```

## Определение ролей

### 1. super_admin (Основатель/Владелец)
**Описание:** Основатель и владелец платформы. Имеет полный контроль над платформой и ядром.

**Права доступа:**
- Управление платформой и ядром
- Управление тарифами
- Управление пользователями (назначение, подключение, отключение)
- Полный доступ ко всем функциям системы

**Дашборд:** `/super-admin` (порт 7002)

**Действия:**
- Создает и управляет тарифами
- Назначает и отключает пользователей
- Контролирует всю платформу

---

### 2. platform_master (Модератор контента платформы)
**Описание:** Модератор, управляющий контентом платформеной страницы (landing page).

**Права доступа:**
- Управление контентом платформеной страницы
- Редактирование Hero Banner
- Редактирование секций контента
- Управление модулями платформы
- Просмотр статистики платформы

**Дашборд:** `/platform-dashboard` (порт 7001)

**Действия:**
- Редактирует контент платформеной страницы
- Загружает изображения и видео для Hero Banner
- Управляет модулями платформы
- Модерация публичного контента

---

### 3. user (Публичный пользователь)
**Описание:** Публичный пользователь, который просто смотрит платформеную страницу и не зарегистрировался.

**Права доступа:**
- Просмотр платформеной страницы (landing page)
- Просмотр информации о платформе
- Просмотр тарифов
- Доступ к публичной информации

**Особенности:**
- Не зарегистрирован
- Не имеет личного кабинета
- Может просматривать только публичный контент
- Может зарегистрироваться как subscriber или buyer

**Действия:**
- Просматривает платформеную страницу
- Изучает информацию о платформе
- Может перейти к регистрации

---

### 4. subscriber (Подписчик)
**Описание:** Пользователь, который использует подписку и арендует платформу для своего бизнеса.

**Права доступа:**
- Управление своим интернет-магазином/сайтом
- Управление товарами и услугами
- Управление заказами
- Настройки своего магазина
- Доступ к модулям согласно подписке
- Управление покупателями (buyers)

**Особенности:**
- Связан с tenant (арендатор)
- Имеет свой поддомен
- Платит за подписку по тарифу
- Создает и управляет своим магазином

**Действия:**
- Регистрируется и выбирает тариф
- Настраивает свой интернет-магазин
- Добавляет товары и услуги
- Принимает заказы от покупателей
- Управляет своим бизнесом

---

### 5. buyer (Покупатель)
**Описание:** Клиент подписчика, который покупает товары/услуги у подписчика.

**Права доступа:**
- Просмотр каталога подписчика
- Добавление товаров в корзину
- Оформление заказов
- Просмотр истории заказов
- Профиль покупателя

**Особенности:**
- Является клиентом подписчика (tenant)
- Не имеет доступа к админ-панели подписчика
- Может иметь личный кабинет на сайте подписчика
- Работает только в рамках магазина подписчика

**Действия:**
- Просматривает каталог товаров подписчика
- Добавляет товары в корзину
- Оформляет заказы
- Отслеживает статус заказов
- Управляет своим профилем покупателя

## Использование ролей

### Проверка ролей в коде

```python
from app.models.roles import UserRole

# Проверка роли (по иерархии)
if user.role == UserRole.super_admin:
    # Доступ для основателя
    pass

if user.role == UserRole.platform_master:
    # Доступ для модератора контента
    pass

if user.role == UserRole.user:
    # Доступ для публичного пользователя (может быть не зарегистрирован)
    pass

if user.role == UserRole.subscriber:
    # Доступ для подписчика
    pass

if user.role == UserRole.buyer:
    # Доступ для покупателя
    pass
```

### Зависимости FastAPI

```python
from app.api.deps.dependencies import (
    require_platform_master,
    require_super_admin,
    require_user,
    require_subscriber,
    require_buyer
)

@router.get("/content")
async def get_content(user: dict = Depends(require_platform_master)):
    # Доступ только для platform_master
    pass

@router.get("/users")
async def get_users(user: dict = Depends(require_super_admin)):
    # Доступ только для super_admin
    pass

@router.get("/public")
async def get_public():
    # Публичный доступ (user или неавторизованный)
    pass

@router.get("/shop")
async def get_shop(user: dict = Depends(require_subscriber)):
    # Доступ только для subscriber
    pass

@router.get("/catalog")
async def get_catalog(user: dict = Depends(require_buyer)):
    # Доступ только для buyer
    pass
```

## Понимание иерархии

### Уровень платформы (Platform Level)
- **super_admin** → Управляет всей платформой
- **platform_master** → Управляет контентом платформеной страницы
- **user** → Просматривает платформеную страницу

### Уровень подписчика (Subscriber Level)
- **subscriber** → Владелец магазина, арендует платформу
- **buyer** → Клиент подписчика, покупает товары

### Связи между ролями

1. **Основатель** (super_admin) назначает **Модератора** (platform_master)
2. **Модератор** управляет контентом для **Пользователя** (user)
3. **Пользователь** (user) может зарегистрироваться как **Подписчик** (subscriber)
4. **Подписчик** (subscriber) создает магазин
5. **Покупатель** (buyer) покупает товары у **Подписчика** (subscriber)

